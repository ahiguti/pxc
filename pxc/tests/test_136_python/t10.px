public namespace t10;
import common -;
import python py;

public struct foo {
  int x;
  string z;
  function string bar(int v) {
    println("bar is called", v);
    x = v;
    z = string_join{""}("bar: ", v * 3);
    return z;
  }
  function int get_x() {
    return x;
  }
}

{
  try {
    py::register_class{foo}();
    py::pxc_module_init();
    mutable global = py::module("__main__").__dict__;
    py::exec("import pxc", global, global);
    const f = py::eval("pxc.t10_foo()", global, global);
    const s = f.bar(33); /* s is a python string */
    println(s);
  } catch (py::error_already_set e) {
    py::error_print();
  }
}

