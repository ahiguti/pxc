
namespace elem5;
import test_common "";

struct foo {
  int value;
}

function foo f1(vector{foo}& v, foo const& x) // x is passed by const ref
{
  io::println("a");
  v.resize(20, foo()); // would invalidate
  io::println("b");
  return x;
}

function void test1()
{
  vector{foo} v;
  v.resize(10, foo());
  v[3] = foo(10);
  foo z = f1(v, v[3]);
  v[3] = foo(5);
  io::println(v[3].value);
  io::println(z.value);
}

test1();
