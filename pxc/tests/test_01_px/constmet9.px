import common -;

namespace constmet9;

threaded struct foo {
  int x;
  function int n(int y) {
    int oldx = x;
    x = y;
    return oldx;
  }
  function int m(int y) {
    threaded function int nf(int z) {
      x = 99; // ok to modify
      return z;
    }
    return nf(y);
  }
}

{
  ptr{foo} v = ptr{foo}(foo(10));
  println(v->m(20));
}

