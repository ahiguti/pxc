namespace interfthr;
import common -;
import thread -;

multithreaded interface ifoo {
  function int get_v() const;
}

multithreaded struct sfoo < ifoo > {
  int v;
  function int get_v() const { return v; }
}

multithreaded struct my_thread_obj(int x0, int y0, tptr{ifoo} p0,
  io::io sys0) {
  int x = x0;
  int y = y0;
  io::io sys = sys0;
  tptr{ifoo} p = p0;
  function void main() {
    const stdout = sys.stdout();
    io::standard::file_println(stdout, "my thread main");
    io::standard::file_println(stdout, x);
    io::standard::file_println(stdout, y);
    io::standard::file_println(stdout, p->get_v());
  }
}

function void test1()
{
  tptr{sfoo} p = make_tptr(sfoo(3));
  thread thr = make_thread(my_thread_obj(123, 456, p, io::system));
  thr.join();
}

test1();

